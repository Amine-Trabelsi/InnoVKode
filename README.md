# Inno-VKode

## Обзор проекта

Inno-VKode — это университетский ассистент для мессенджера Max.
Проект объединяет бэкенд на FastAPI и бот на Go для работы с академической информацией.

### Основные возможности

- **Студенты** — расписание, справки, конспекты лекций, тесты, общежитие, библиотека
- **Сотрудники** — заявки на отпуск, командировки, справки, управление визами
- **Абитуриенты** — информация о программах, запись на дни открытых дверей
- **Руководство** — дашборды, аналитика, мониторинг новостей

## Структура проекта

| Папка | Описание                                      |
|-------|-----------------------------------------------|
| `be/` | FastAPI бэкенд с базой данных PostgreSQL      |
| `fe/` | Go бот для Max с кнопочным интерфейсом        |

## Как запустить проект

### Быстрый старт с Docker

**Требования:**

- Docker и Docker Compose
- Токен Max бота

**Шаги запуска:**

1. Клонируйте репозиторий:

  ```bash
  git clone <repository-url>
  cd inno-vkode
  ```

2. Установите токен Max бота в `docker-compose.yaml` (переменная `MAX_BOT_TOKEN`)


3. Запустите все сервисы:

  ```bash
  docker compose up --build
  ```

4. Откройте API документацию: `http://localhost:8000/docs`

5. Начните диалог с ботом в мессенджере Max

  **Остановка:**

  ```bash
  docker compose down          # Остановить сервисы
  docker compose down -v       # Остановить и удалить данные
  ```

### Аутентификация через OTP

При входе в систему бот отправляет одноразовый пароль (OTP) на email пользователя. В текущей конфигурации проекта email не отправляется реально — вместо этого **код OTP выводится в логи контейнера бота**.

**Как получить код OTP:**

1. Начните процесс входа в боте Max (выберите "Login")
2. Введите ваш email
3. Посмотрите логи контейнера бота:

  ```bash
  docker logs fe
  ```

4. Найдите строку с вашим email и кодом:

  ```json
  INF OTP dispatched code=CODE email=EMAIL
  ```

5. Введите полученный код в боте для завершения входа

**Важно:** OTP действителен в течение 5 минут (настраивается через `OTP_EXPIRY`).

## Конфигурация

Основные переменные окружения в `docker-compose.yaml`:

| Переменная           | Описание                              |
|----------------------|---------------------------------------|
| `MAX_BOT_TOKEN`      | Токен Max бота (обязательно)          |
| `BACKEND_BASE_URL`   | URL бэкенда (по умолчанию: `http://be:8000`) |
| `RESET_DB_ON_STARTUP`| Пересоздавать БД при старте (true/false) |
| `LOG_LEVEL`          | Уровень логирования (info, debug, error) |

## Технологии

- **Backend:** FastAPI, PostgreSQL, SQLAlchemy
- **Bot:** Go, Max Bot API
- **Deployment:** Docker, Docker Compose

## Устранение неполадок

**Проверка логов:**

```bash
docker logs be    # Логи бэкенда
docker logs fe    # Логи бота
docker logs db    # Логи базы данных
```

**Проверка статуса:**

```bash
docker compose ps
```

**Типичные проблемы:**

- БД сбрасывается — установите `RESET_DB_ON_STARTUP=false`
- Бот не подключается — проверьте `MAX_BOT_TOKEN`
- Ошибки подключения — убедитесь, что все контейнеры запущены
